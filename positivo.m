%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%               Upwinding                                                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
for i=1:2
Dsl(:,:,i)=funl(i,:,i);
end 
Ds2(1,1:7,1)=[d2(1,1:3,1),dx2p(1,1),dl(1,1:2,1),dxpl(1,1)];
for k=2:n-2
     for j=1:3
    Ds(1,1:8,k+1)=[d2(1,1:3,k),dx2p(1,j),d(1,1:3,k),dxp(1,j)];
     end 
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%           matrix U                                           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
for k=2:n-1
for i=1:3
    for j=1:3
    CU(:,:,k)=C(1:4,1:3,k)';
    end
end
end

for k=1:2
for i=1:3
    for j=1:2
        CUL(:,:,k)=Cl(1:3,1:2,k)';
    end
end
end

 for i=1:2
    ul(:,:,i)=CUL(:,:,i)*Dsl(1,:,i)';
    Ul(:,:,i)=ul(:,:,i)';
 end 
  
 U1=Ul(:,:,1);
 u11=Cl(:,:,1)';
 u2=[CU(:,:,2),u11]*Ds2';
 U2=u2';
for i=3:n-1
a(:,:,i)=[CU(:,:,i);zeros(1,4)];
a2(:,:,i)=[zeros(1,4);CU(:,:,i-1)];
u(:,:,i)=[a2(:,:,i),a(:,:,i)]*Ds(:,:,i)';
U(:,:,i)=u(:,:,i)';
end

u=zeros(n,n);
u(1,1:2)=Ul(:,:,1);
u(2,1:3)=U2;
u(3,1:4)=U(:,:,3);
u(n,n-1:n)=Ul(:,:,2);

for i=4:n-1
         u(i,i-2:i+1)=U(:,:,i);
 end

U=inv(u)*b       

